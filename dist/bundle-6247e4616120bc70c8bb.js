(()=>{var __webpack_modules__={852:(t,e,r)=>{"use strict";r.r(e)},451:t=>{var e=function(){var t=function(t,r,n){this.errors=[],void 0===n.raw&&(this.errors.push("Empty input for node"),n.raw=""),t instanceof e.Grammar?(this.grammar=t,this.parent=null,this.depth=0,this.childIndex=0):(this.grammar=t.grammar,this.parent=t,this.depth=t.depth+1,this.childIndex=r),this.raw=n.raw,this.type=n.type,this.isExpanded=!1,this.grammar||this.errors.push("No grammar specified for this node "+this)};function r(t,e){this.node=t;var r=e.split(":");this.target=r[0],1===r.length?this.type=2:(this.rule=r[1],"POP"===this.rule?this.type=1:this.type=0)}function n(t,e){this.raw=e,this.grammar=t,this.falloff=1,Array.isArray(e)?this.defaultRules=e:("string"==typeof e||e instanceof String)&&(this.defaultRules=[e])}t.prototype.toString=function(){return"Node('"+this.raw+"' "+this.type+" d:"+this.depth+")"},t.prototype.expandChildren=function(r,n){if(this.children=[],this.finishedText="",this.childRule=r,void 0!==this.childRule){var i=e.parse(r);i.errors.length>0&&(this.errors=this.errors.concat(i.errors));for(var a=0;a<i.length;a++)this.children[a]=new t(this,a,i[a]),n||this.children[a].expand(n),this.finishedText+=this.children[a].finishedText}else this.errors.push("No child rule provided, can't expand children")},t.prototype.expand=function(t){if(!this.isExpanded)switch(this.isExpanded=!0,this.expansionErrors=[],this.type){case-1:this.expandChildren(this.raw,t);break;case 0:this.finishedText=this.raw;break;case 1:this.preactions=[],this.postactions=[];var n=e.parseTag(this.raw);this.symbol=n.symbol,this.modifiers=n.modifiers;for(var i=0;i<n.preactions.length;i++)this.preactions[i]=new r(this,n.preactions[i].raw);for(i=0;i<n.postactions.length;i++);for(i=0;i<this.preactions.length;i++)0===this.preactions[i].type&&this.postactions.push(this.preactions[i].createUndo());for(i=0;i<this.preactions.length;i++)this.preactions[i].activate();this.finishedText=this.raw;var a=this.grammar.selectRule(this.symbol,this,this.errors);for(this.expandChildren(a,t),i=0;i<this.modifiers.length;i++){var s=this.modifiers[i],o=[];if(s.indexOf("(")>0){var u=/\(([^)]+)\)/.exec(this.modifiers[i]);!u||u.length<2||(o=u[1].split(","),s=this.modifiers[i].substring(0,s.indexOf("(")))}var h=this.grammar.modifiers[s];h?this.finishedText=h(this.finishedText,o):(this.errors.push("Missing modifier "+s),this.finishedText+="((."+s+"))")}for(i=0;i<this.postactions.length;i++)this.postactions[i].activate();break;case 2:this.action=new r(this,this.raw),this.action.activate(),this.finishedText=""}},t.prototype.clearEscapeChars=function(){this.finishedText=this.finishedText.replace(/\\\\/g,"DOUBLEBACKSLASH").replace(/\\/g,"").replace(/DOUBLEBACKSLASH/g,"\\")},r.prototype.createUndo=function(){return 0===this.type?new r(this.node,this.target+":POP"):null},r.prototype.activate=function(){var e=this.node.grammar;switch(this.type){case 0:this.ruleSections=this.rule.split(","),this.finishedRules=[],this.ruleNodes=[];for(var r=0;r<this.ruleSections.length;r++){var n=new t(e,0,{type:-1,raw:this.ruleSections[r]});n.expand(),this.finishedRules.push(n.finishedText)}e.pushRules(this.target,this.finishedRules,this);break;case 1:e.popRules(this.target);break;case 2:e.flatten(this.target,!0)}},r.prototype.toText=function(){switch(this.type){case 0:return this.target+":"+this.rule;case 1:return this.target+":POP";case 2:return"((some function))";default:return"((Unknown Action))"}},n.prototype.selectRule=function(t){if(this.conditionalRule){var e=this.grammar.expand(this.conditionalRule,!0);if(this.conditionalValues[e]&&null!=(n=this.conditionalValues[e].selectRule(t)))return n}if(this.ranking)for(var r=0;r<this.ranking.length;r++){var n;if(null!=(n=this.ranking.selectRule()))return n}if(void 0!==this.defaultRules){var i=0,a=this.distribution;switch(a||(a=this.grammar.distribution),a){case"shuffle":this.shuffledDeck&&0!==this.shuffledDeck.length||(this.shuffledDeck=function(t,e){for(var r,n,i=t.length;0!==i;)n=Math.floor(Math.random()*i),r=t[i-=1],t[i]=t[n],t[n]=r;return t}(Array.apply(null,{length:this.defaultRules.length}).map(Number.call,Number),this.falloff)),i=this.shuffledDeck.pop();break;case"weighted":t.push("Weighted distribution not yet implemented");break;case"falloff":t.push("Falloff distribution not yet implemented");break;default:i=Math.floor(Math.pow(Math.random(),this.falloff)*this.defaultRules.length)}return this.defaultUses||(this.defaultUses=[]),this.defaultUses[i]=++this.defaultUses[i]||1,this.defaultRules[i]}return t.push("No default rules defined for "+this),null},n.prototype.clearState=function(){this.defaultUses&&(this.defaultUses=[])};var i=function(t,e,r){this.key=e,this.grammar=t,this.rawRules=r,this.baseRules=new n(this.grammar,r),this.clearState()};i.prototype.clearState=function(){this.stack=[this.baseRules],this.uses=[],this.baseRules.clearState()},i.prototype.pushRules=function(t){var e=new n(this.grammar,t);this.stack.push(e)},i.prototype.popRules=function(){this.stack.pop()},i.prototype.selectRule=function(t,e){return this.uses.push({node:t}),0===this.stack.length?(e.push("The rule stack for '"+this.key+"' is empty, too many pops?"),"(("+this.key+"))"):this.stack[this.stack.length-1].selectRule()},i.prototype.getActiveRules=function(){return 0===this.stack.length?null:this.stack[this.stack.length-1].selectRule()},i.prototype.rulesToJSON=function(){return JSON.stringify(this.rawRules)};var a=function(t,e){this.modifiers={},this.loadFromRawObj(t)};function s(t){var e=t.toLowerCase();return"a"===e||"e"===e||"i"===e||"o"===e||"u"===e}a.prototype.clearState=function(){for(var t=Object.keys(this.symbols),e=0;e<t.length;e++)this.symbols[t[e]].clearState()},a.prototype.addModifiers=function(t){for(var e in t)t.hasOwnProperty(e)&&(this.modifiers[e]=t[e])},a.prototype.loadFromRawObj=function(t){if(this.raw=t,this.symbols={},this.subgrammars=[],this.raw)for(var e in this.raw)this.raw.hasOwnProperty(e)&&(this.symbols[e]=new i(this,e,this.raw[e]))},a.prototype.createRoot=function(e){return new t(this,0,{type:-1,raw:e})},a.prototype.expand=function(t,e){var r=this.createRoot(t);return r.expand(),e||r.clearEscapeChars(),r},a.prototype.flatten=function(t,e){return this.expand(t,e).finishedText},a.prototype.toJSON=function(){for(var t=Object.keys(this.symbols),e=[],r=0;r<t.length;r++){var n=t[r];e.push(' "'+n+'" : '+this.symbols[n].rulesToJSON())}return"{\n"+e.join(",\n")+"\n}"},a.prototype.pushRules=function(t,e,r){void 0===this.symbols[t]?(this.symbols[t]=new i(this,t,e),r&&(this.symbols[t].isDynamic=!0)):this.symbols[t].pushRules(e)},a.prototype.popRules=function(t){this.symbols[t]||this.errors.push("Can't pop: no symbol for key "+t),this.symbols[t].popRules()},a.prototype.selectRule=function(t,e,r){if(this.symbols[t])return this.symbols[t].selectRule(e,r);for(var n=0;n<this.subgrammars.length;n++)if(this.subgrammars[n].symbols[t])return this.subgrammars[n].symbols[t].selectRule();return r.push("No symbol for '"+t+"'"),"(("+t+"))"};var o={replace:function(t,e){return t.replace(new RegExp(e[0].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),e[1])},capitalizeAll:function(t){for(var e,r="",n=!0,i=0;i<t.length;i++)(e=t.charAt(i))>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"?n?(r+=t.charAt(i).toUpperCase(),n=!1):r+=t.charAt(i):(n=!0,r+=t.charAt(i));return r},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1)},a:function(t){if(t.length>0){if("u"===t.charAt(0).toLowerCase()&&t.length>2&&"i"===t.charAt(2).toLowerCase())return"a "+t;if(s(t.charAt(0)))return"an "+t}return"a "+t},firstS:function(t){console.log(t);var e=t.split(" "),r=o.s(e[0])+" "+e.slice(1).join(" ");return console.log(r),r},s:function(t){switch(t.charAt(t.length-1)){case"s":case"h":case"x":return t+"es";case"y":return s(t.charAt(t.length-2))?t+"s":t.substring(0,t.length-1)+"ies";default:return t+"s"}},ed:function(t){switch(t.charAt(t.length-1)){case"s":return t+"ed";case"e":return t+"d";case"h":case"x":return t+"ed";case"y":return s(t.charAt(t.length-2))?t+"d":t.substring(0,t.length-1)+"ied";default:return t+"ed"}}};return(e={createGrammar:function(t){return new a(t)},parseTag:function(t){for(var r={symbol:void 0,preactions:[],postactions:[],modifiers:[]},n=e.parse(t),i=void 0,a=0;a<n.length;a++)if(0===n[a].type){if(void 0!==i)throw"multiple main sections in "+t;i=n[a].raw}else r.preactions.push(n[a]);if(void 0===i);else{var s=i.split(".");r.symbol=s[0],r.modifiers=s.slice(1)}return r},parse:function(t){var e=0,r=!1,n=[],i=!1,a=[],s=0,o="",u=void 0;if(null===t)return(n=[]).errors=a,n;function h(e,r,i){var s;r-e<1&&(1===i&&a.push(e+": empty tag"),2===i&&a.push(e+": empty action")),s=void 0!==u?o+"\\"+t.substring(u+1,r):t.substring(e,r),n.push({type:i,raw:s}),u=void 0,o=""}for(var l=0;l<t.length;l++)if(i)i=!1;else switch(t.charAt(l)){case"[":0!==e||r||(s<l&&h(s,l,0),s=l+1),e++;break;case"]":0!=--e||r||(h(s,l,2),s=l+1);break;case"#":0===e&&(r?(h(s,l,1),s=l+1):(s<l&&h(s,l,0),s=l+1),r=!r);break;case"\\":i=!0,o+=t.substring(s,l),s=l+1,u=l}return s<t.length&&h(s,t.length,0),r&&a.push("Unclosed tag"),e>0&&a.push("Too many ["),e<0&&a.push("Too many ]"),(n=n.filter((function(t){return 0!==t.type||0!==t.raw.length}))).errors=a,n}}).baseEngModifiers=o,e.TraceryNode=t,e.Grammar=a,e.Symbol=i,e.RuleSet=n,e}();t.exports=e},333:function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.PixelsData=e.Canvas=e.Rgba=void 0;var a=r(959),s=function(){function t(t,e,r,n){this.red=t,this.green=e,this.blue=r,this.alpha=n}return t.randRgb=function(){return new t(a.randInt(0,256),a.randInt(0,256),a.randInt(0,256),255)},t.prototype.interpolate=function(e,r){return new t(a.interpolate(this.red,e.red,r),a.interpolate(this.green,e.green,r),a.interpolate(this.blue,e.blue,r),a.interpolate(this.alpha,e.alpha,r))},t.prototype.normalise=function(){return new t(a.limNumber(0,255,this.red),a.limNumber(0,255,this.green),a.limNumber(0,255,this.blue),a.limNumber(0,255,this.alpha))},t.prototype.mutateRgb=function(e){return new t(this.red+a.randFloat(-e,e),this.green+a.randFloat(-e,e),this.blue+a.randFloat(-e,e),this.alpha).normalise()},t.prototype.difference=function(e){return(Math.abs(this.red-e.red)+Math.abs(this.green-e.green)+Math.abs(this.blue-e.blue)+Math.abs(this.alpha-e.alpha))/t.MAX_DIF},t.MAX_DIF=1020,t}();e.Rgba=s;var o=function(t,e,r){this.node=r||document.createElement("canvas"),this.node.width=t,this.node.height=e,this.ctx=this.node.getContext("2d")};e.Canvas=o;var u=function(t){function e(e,r,n){var i=t.call(this,e,r,n)||this;return i.data=i.ctx.createImageData(i.node.width,i.node.height),i}return i(e,t),e.prototype.setPixel=function(t,e,r){var n=4*(e*this.data.width+t);this.data.data[n]=r.red,this.data.data[n+1]=r.green,this.data.data[n+2]=r.blue,this.data.data[n+3]=r.alpha},e.prototype.update=function(){return this.ctx.putImageData(this.data,0,0),this},e}(o);e.PixelsData=u},959:function(t,e){"use strict";var r=this&&this.__generator||function(t,e){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};function n(t,e){return Math.random()*(e-t)+t}function i(t,e){return Math.floor(n(t,e))}Object.defineProperty(e,"__esModule",{value:!0}),e.interpolate=e.limNumber=e.normalizeNumber=e.fixNumber=e.randChoice=e.randInt=e.randFloat=e.range=void 0,e.range=function(t,e){return r(this,(function(r){switch(r.label){case 0:return t<e?[4,t++]:[3,2];case 1:return r.sent(),[3,0];case 2:return[2]}}))},e.randFloat=n,e.randInt=i,e.randChoice=function(t){return t[i(0,t.length)]},e.fixNumber=function(t,e,r){return r>=t?r%e:e- -r%e},e.normalizeNumber=function(t,e,r){return(r-t)/(e-t)},e.limNumber=function(t,e,r){return Math.max(Math.min(r,e),t)},e.interpolate=function(t,e,r){return t+(e-t)*r}}},__webpack_module_cache__={};function __webpack_require__(t){if(__webpack_module_cache__[t])return __webpack_module_cache__[t].exports;var e=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(e.exports,e,e.exports,__webpack_require__),e.exports}__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";var exports=__webpack_exports__,__webpack_unused_export__;__webpack_unused_export__={value:!0},__webpack_require__(852);var drawing_1=__webpack_require__(333),math_functions_1=__webpack_require__(959),tracery_grammar_1=__webpack_require__(451),W=256,H=256,PX=2,sin=Math.sin,asin=Math.asin,cos=Math.cos,acos=Math.acos,tan=Math.tan,atan=Math.atan,hypot=Math.hypot,round=Math.round,rand=Math.random,abs=Math.abs,sqrt=Math.sqrt,cbrt=Math.cbrt,avg=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce((function(t,e){return t+e}))/t.length};function generate(t){var e;do{e=grammar.flatten("#formula#")}while(e.length<t);return e}var grammar=tracery_grammar_1.createGrammar({formula:["#formula# #operator# #formula#","#func#","#number#","#number#"],func:["#func_1#","#func_2#"],func_1:["sin(#formula#)","cos(#formula#)","abs(#formula#)"],func_2:["hypot(#formula#, #formula#)"],number:["rand()","x","y","t"],operator:["+","-","*","/","==",">","<","&","|","^","%"]});onload=function(){function onInputFromula(){eval("formula = (x, y) => "+formulaInputNode.value),t=0}var imgNode=document.querySelector("#img"),formulaInputNode=document.querySelector("#formula");formulaInputNode.oninput=onInputFromula;var randomNode=document.querySelector("#generate-random");randomNode.onclick=function(){var t=generate(50);formulaInputNode.value=t,onInputFromula()};var minOutput=document.querySelector("#min"),maxOutput=document.querySelector("#max"),timeOutput=document.querySelector("#time"),errOutput=document.querySelector("#err"),canvas=new drawing_1.Canvas(W*PX,H*PX,imgNode);canvas.ctx.imageSmoothingEnabled=!1;var pixels=new drawing_1.PixelsData(W,H),formula;eval("formula = (x, y, t, i) => "+formulaInputNode.value);var t=0;setInterval((function(){var e=[],r=1/0,n=-1/0;try{errOutput.innerHTML="";for(var i=0;i<W;i++){e[i]=[];for(var a=0;a<H;a++){var s=formula(i-W/2,a-H/2,t,i+a*W);e[i][a]=s,r=Math.min(r,s),n=Math.max(n,s)}}}catch(t){errOutput.innerHTML=t}for(minOutput.innerHTML=r.toString(),maxOutput.innerHTML=n.toString(),timeOutput.innerHTML=t.toString(),i=0;i<W;i++)for(a=0;a<H;a++){var o=math_functions_1.normalizeNumber(r,n,e[i][a]);pixels.setPixel(i,a,new drawing_1.Rgba(0,0,0,255).interpolate(new drawing_1.Rgba(255,255,255,255),o))}pixels.update(),canvas.ctx.drawImage(pixels.node,0,0,canvas.node.width,canvas.node.height),t+=1}))}})()})();
//# sourceMappingURL=bundle-6247e4616120bc70c8bb.js.map